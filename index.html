<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Compteur Coinche â€“belote et boules (flux 2 Ã©tapes)</title>
<style>
  :root{
    --bg:#FAF6F2; --card:#FFFFFF; --txt:#2B3640; --muted:#6B7A8C; --border:#E9E5E0; --accent:#466781;
  }
  html,body{margin:0;padding:0;background:var(--bg);color:var(--txt);font:16px/1.4 Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial}
  .wrap{max-width:920px;margin:24px auto;padding:16px}
  h1{font-size:22px;margin:0 0 12px;font-weight:800}
  .card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:14px;margin-bottom:14px;box-shadow:0 6px 18px rgba(0,0,0,.06)}
  .row{display:flex;gap:10px;flex-wrap:wrap}
  .col{flex:1 1 200px}
  label{display:block;font-size:12px;color:var(--muted);margin:0 0 6px}
  input[type="number"],select{
    width:100%;box-sizing:border-box;background:#fff;border:1px solid var(--border);border-radius:10px;
    padding:10px 12px;font-size:15px;color:var(--txt);outline:none
  }
  .btn{appearance:none;border:1px solid var(--border);background:#fff;border-radius:999px;padding:10px 14px;
       font-weight:600;cursor:pointer}
  .btn.primary{background:var(--accent);border-color:var(--accent);color:#fff}
  .btn.danger{background:#b94747;border-color:#b94747;color:#fff}
  .btn.ghost{background:#fff;color:var(--txt)}
  .scores{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:4px}
  .scorebox{border:1px solid var(--border);border-radius:12px;padding:12px;text-align:center;background:#fff}
  .scorebox h3{margin:0 0 4px;font-size:16px}
  .score{font-size:28px;font-weight:800}
  .progress{height:8px;background:#ece7e1;border-radius:999px;overflow:hidden;margin-top:8px}
  .bar{height:100%;background:var(--accent);width:0%}
  table{width:100%;border-collapse:collapse}
  th,td{border-bottom:1px solid var(--border);padding:10px;font-size:14px}
  th{background:#f7f4f0;text-align:left;color:#354556}
  tr:hover td{background:#faf9f7}
  .right{text-align:right}
  .editable{outline:1px dashed transparent}
  .editable:focus{outline-color:var(--accent); background:#f5f9fc}
  .tag{display:inline-block;padding:2px 8px;border:1px solid var(--border);border-radius:999px;font-size:12px;color:#425363;background:#f7fafc;margin-left:6px}
</style>
</head>
<body>
<div class="wrap">
  <h1>Compteur Coinche â€“ 2000 points</h1>

  <!-- SCORES -->
  <div class="card">
    <div class="scores">
      <div class="scorebox">
        <h3>Ã‰quipe A</h3>
        <div class="score" id="scoreA">0</div>
        <div class="progress"><div class="bar" id="barA"></div></div>
      </div>
      <div class="scorebox">
        <h3>Ã‰quipe B</h3>
        <div class="score" id="scoreB">0</div>
        <div class="progress"><div class="bar" id="barB"></div></div>
      </div>
    </div>
  </div>

  <!-- ETAPE 1 : PRISE & ANNONCE -->
  <div class="card">
    <div class="row">
      <div class="col">
        <label>Preneur</label>
        <select id="preneur">
          <option value="A">Ã‰quipe A</option>
          <option value="B">Ã‰quipe B</option>
        </select>
      </div>
      <div class="col">
        <label>Couleur (atout)</label>
        <select id="suit">
          <option value="â™ ">â™  Pique</option>
          <option value="â™¥">â™¥ CÅ“ur</option>
          <option value="â™¦">â™¦ Carreau</option>
          <option value="â™£">â™£ TrÃ¨fle</option>
          <option value="SA">Sans atout</option>
          <option value="TA">Tout atout</option>
        </select>
      </div>
      <div class="col">
        <label>Coinche</label>
        <select id="coinche">
          <option value="1">Aucune (Ã—1)</option>
          <option value="2">CoinchÃ©e (Ã—2)</option>
        </select>
      </div>
      <div class="col">
        <label>Annonce (80â€“160)</label>
        <input id="annonce" type="number" min="80" max="160" step="10" placeholder="ex. 100">
      </div>
      <div class="col" style="align-self:end">
        <button class="btn primary" id="start">DÃ©marrer la donne</button>
      </div>
    </div>
    <div id="current" style="margin-top:8px; display:none">
      <strong>Donne en cours :</strong>
      <span class="tag" id="currentTxt"></span>
      <button class="btn ghost" id="cancel" style="margin-left:8px">Annuler</button>
    </div>
  </div>

  <!-- ETAPE 2 : SCORES -->
  <div class="card">
    <div class="row">
      <div class="col">
        <label>Points faits par le preneur (0â€“162)</label>
        <input id="scoreFait" type="number" min="0" max="162" placeholder="ex. 82">
      </div>
      <div class="col" style="align-self:end">
        <button class="btn primary" id="validate" disabled>Valider les scores</button>
      </div>
    </div>
  </div>

  <!-- HISTORIQUE -->
  <div class="card">
    <div style="overflow:auto;margin-top:8px">
      <table id="tbl">
        <thead>
          <tr>
            <th>#</th>
            <th>DÃ©tails (contrat + couleur + preneur)</th>
            <th class="right">+A</th>
            <th class="right">+B</th>
            <th class="right">Î£A</th>
            <th class="right">Î£B</th>
            <th></th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
    <div id="winner" style="margin-top:10px"></div>
  </div>
</div>

<script>
(function(){
  const $ = s => document.querySelector(s);
  const TARGET = 2000;
  const state = { rounds:[], current:null };

  const els = {
    scoreA: $('#scoreA'), scoreB: $('#scoreB'),
    barA: $('#barA'), barB: $('#barB'),
    preneur: $('#preneur'), suit: $('#suit'), coinche: $('#coinche'), annonce: $('#annonce'),
    start: $('#start'), current: $('#current'), currentTxt: $('#currentTxt'), cancel: $('#cancel'),
    scoreFait: $('#scoreFait'), validate: $('#validate'),
    tblBody: $('#tbl tbody'), winner: $('#winner')
  };

  function clamp(n,min,max){ n=Number(n)||0; return Math.max(min, Math.min(max, n)); }

  function startHand(){
    const pr=els.preneur.value, suit=els.suit.value, mul=parseInt(els.coinche.value,10)||1;
    const annonce=clamp(els.annonce.value,80,160);
    if(!annonce){ alert('Entre une annonce (80â€“160).'); return; }
    state.current = {pr, suit, mul, annonce};
    els.currentTxt.textContent = `${annonce} ${suit} â€” Preneur ${pr==='A'?'Ã‰quipe A':'Ã‰quipe B'}${mul>1?' â€” coinchÃ©':''}`;
    els.current.style.display='block';
    els.validate.disabled=false;
    els.preneur.value='A'; els.suit.value='â™ '; els.coinche.value='1'; els.annonce.value='';
  }

  function cancelHand(){
    state.current=null;
    els.current.style.display='none';
    els.validate.disabled=true;
  }

  function computeRound(current, sfRaw){
    const pr=current.pr, df=(pr==='A'?'B':'A');
    const suit=current.suit, mul=current.mul;
    const annonce=current.annonce;
    const sf=clamp(sfRaw,0,162);
    const tookAll=(sf>=160); const success=(sf>=annonce);
    let a=0,b=0,details='';
    if(annonce>=160){
      if(tookAll){ const pts=500*mul; if(pr==='A')a=pts; else b=pts;
        details=`Capot annoncÃ© ${suit} â€” Preneur ${pr==='A'?'Ã‰quipe A':'Ã‰quipe B'}${mul>1?' â€” coinchÃ©':''}`;
      }else{ const pts=250*mul + 160; if(df==='A')a=pts; else b=pts;
        details=`Capot annoncÃ© ${suit} â€” Preneur ${pr==='A'?'Ã‰quipe A':'Ã‰quipe B'}${mul>1?' â€” coinchÃ©':''}`;
      }
    }else if(tookAll){
      const pts=(250+annonce)*mul; if(pr==='A')a=pts; else b=pts;
      details=`Capot non annoncÃ© ${suit} â€” Preneur ${pr==='A'?'Ã‰quipe A':'Ã‰quipe B'}${mul>1?' â€” coinchÃ©':''}`;
    }else if(success){
      const prPts=(annonce+sf)*mul, defPts=162-sf;
      if(pr==='A'){ a=prPts; b=defPts; } else { b=prPts; a=defPts; }
      details=`${annonce} ${suit} â€” Preneur ${pr==='A'?'Ã‰quipe A':'Ã‰quipe B'}${mul>1?' â€” coinchÃ©':''}`;
    }else{
      const defPts=annonce*mul+160;
      if(df==='A'){ a=defPts; } else { b=defPts; }
      details=`${annonce} ${suit} â€” Preneur ${pr==='A'?'Ã‰quipe A':'Ã‰quipe B'}${mul>1?' â€” coinchÃ©':''}`;
    }
    return {a,b,details};
  }

  function addRound(){
    if(!state.current){ alert('Commence par dÃ©finir la prise et lâ€™annonce (Ã‰tape 1).'); return; }
    const sf=els.scoreFait.value;
    if(sf===''){ alert('Entre les points faits par le preneur.'); return; }
    const r=computeRound(state.current, sf);
    state.rounds.push(r);
    state.current=null;
    els.current.style.display='none';
    els.validate.disabled=true;
    els.scoreFait.value='';
    render();
  }

  function totals(){ let a=0,b=0; for(const r of state.rounds){a+=r.a;b+=r.b;} return {a,b}; }

  function render(){
    const {a,b}=totals();
    els.scoreA.textContent=a; els.scoreB.textContent=b;
    els.barA.style.width=Math.min(100,Math.round(100*a/TARGET))+'%';
    els.barB.style.width=Math.min(100,Math.round(100*b/TARGET))+'%';
    els.tblBody.innerHTML=''; let sa=0,sb=0;
    state.rounds.forEach((r,i)=>{
      sa+=r.a; sb+=r.b;
      const tr=document.createElement('tr');
      tr.innerHTML=`
        <td>${i+1}</td>
        <td>${r.details}</td>
        <td class="right editable" contenteditable="true" data-i="${i}" data-k="a">${r.a}</td>
        <td class="right editable" contenteditable="true" data-i="${i}" data-k="b">${r.b}</td>
        <td class="right">${sa}</td>
        <td class="right">${sb}</td>
        <td><button class="btn danger" data-del="${i}">ðŸ—‘</button></td>`;
      els.tblBody.appendChild(tr);
    });
    els.tblBody.querySelectorAll('[contenteditable]').forEach(cell=>{
      cell.addEventListener('blur', ()=>{
        const i=parseInt(cell.dataset.i,10), k=cell.dataset.k;
        let v=parseInt(cell.textContent.trim(),10); if(isNaN(v)||v<0) v=0;
        state.rounds[i][k]=v; render();
      });
      cell.addEventListener('keydown',(e)=>{ if(e.key==='Enter'){ e.preventDefault(); cell.blur(); } });
    });
    els.tblBody.querySelectorAll('button[data-del]').forEach(btn=>{
      btn.onclick=()=>{ state.rounds.splice(parseInt(btn.dataset.del,10),1); render(); };
    });
    els.winner.textContent='';
    if(a>=TARGET || b>=TARGET){
      els.winner.textContent=(a===b?'Ã‰galitÃ©':'Victoire '+(a>b?'Ã‰quipe A':'Ã‰quipe B'))+` (${a}â€“${b})`;
    }
  }

  els.start.addEventListener('click', startHand);
  els.cancel.addEventListener('click', cancelHand);
  els.validate.addEventListener('click', addRound);

  render();
})();
</script>
</body>
</html>

